"id","priority","phase","area","title","description","acceptance_criteria","test_mcp","review_initial_requirements","review_regression_requirements","dev_state","review_initial_state","review_regression_state","git_state","owner","refs","notes"
"CODEX-010","P0","1","both","Freeze Codex parity scope","Define a 1:1 parity matrix vs the existing ClaudeCode shell and lock the acceptance scope for Codex.","Docs exist (en+zh) with a capability matrix; each capability maps to module/file refs + a test/verification method; scope sign-off is recorded in the doc.","AUTOE2E","Clarify the meaning of “1:1”; make every item testable; include security/secret-handling constraints and out-of-scope items explicitly.","Reconfirm the matrix against implemented behavior; update and re-sign if scope changes; ensure all P0 gaps are either fixed or explicitly waived.","已完成","已完成","已完成","已提交","","plan/2026-01-01_14-03-09-codex-shell-claude-code.md:18; executor/agents/claude_code/claude_code_agent.py:58; backend/init_data/02-public-shells.yaml:10; docs/en/guides/developer/codex-shell-parity.md:1; docs/zh/guides/developer/codex-shell-parity.md:1; docs/en/README.md:1; docs/zh/README.md:1","picked_reason:Lock parity scope first to prevent implementation drift and unblock downstream Codex integration. | done_at:2026-01-01 evidence:parity_matrix_docs_added risk:low | blocked:git_commit_failed_missing_identity action:set_git_user_name_email_and_retry | unblocked:git_identity_configured"
"CODEX-020","P0","2","executor","Select Codex runtime and container PoC","Decide Codex CLI vs SDK and validate non-interactive streaming execution inside a container (config/auth included).","Decision doc records runtime choice + pinned versions; a PoC command runs in container and produces captured streaming chunks; required env vars/config paths are documented; invalid/missing credentials produce deterministic errors.","AUTOSERVER","Pin versions; do not bake secrets into images; document config file locations and required env vars; confirm amd64/arm64 availability.","Re-run PoC in a clean container; verify streaming capture and error handling remain stable after dependency bumps.","已完成","已完成","已完成","已提交","","plan/2026-01-01_14-03-09-codex-shell-claude-code.md:19; docker/base/Dockerfile:15; docker/executor/Dockerfile:10; docs/en/guides/developer/codex-shell-runtime.md:1; docs/zh/guides/developer/codex-shell-runtime.md:1","done_at:2026-01-01 evidence:docker_poc_missing_auth_401_jsonl risk:low | blocked:git_commit_msg_hook_requires_conventional_commits action:use_docs(scope):[CODEX-020]_subject | unblocked:commit_message_fixed"
"CODEX-030","P0","3","docker","Build Codex-capable images","Add/update Dockerfiles and build scripts so Codex runtime dependencies are present and multi-arch builds succeed.","Docker images build for amd64+arm64; image contains required binaries (Codex CLI + python3.12 + other deps); versions are pinned in Dockerfiles or documented.","AUTOSERVER","Keep images minimal and cache-friendly; pin key versions; ensure dependency install works behind proxies; avoid duplicating installs across layers.","Validate Codex/ClaudeCode/Agno images; ensure existing image validation behavior is unchanged; run build+validate on both arches.","已完成","已完成","已完成","已提交","","plan/2026-01-01_14-03-09-codex-shell-claude-code.md:20; docker/base/Dockerfile:5; docker/executor/Dockerfile:6; executor_manager/routers/routers.py:446; executor/agents/image_validator/image_validator_agent.py:37; docker/base/Dockerfile:15; docker/executor/Dockerfile:10","scope_adjusted:moved_image_validation_to_CODEX-070_to_avoid_duplication | picked_reason:Install Codex CLI into executor images to unblock CodexAgent execution. | validation_limited:docker_build_timed_out_and_buildx_missing manual_test:DOCKER_BUILDKIT=1_docker_buildx_build_--platform_linux/amd64,linux/arm64_-f_docker/base/Dockerfile_docker/base && docker_run_--rm_<image>_codex_--version evidence:Dockerfiles_pin_@openai/codex@0.77.0 risk:medium"
"CODEX-040","P0","4","executor","Implement CodexAgent + shared abstractions","Add `CodexAgent` and refactor shared logic with `ClaudeCodeAgent` to avoid duplication (git env, hooks, skills, MCP, progress, masking, cancellation).","CodexAgent is registered in AgentFactory; can execute a sample task end-to-end and report progress/thinking steps; cancellation cleans up processes; shared utilities are reused by both agents; executor tests cover key paths.","AUTOSERVER","Avoid copy-paste; extract reusable utilities with clear APIs; maintain sensitive data masking; keep behavior consistent with ClaudeCodeAgent unless explicitly diverging.","Run executor test suite; run one real task (repo clone + edit) for both Codex and ClaudeCode to ensure no regressions.","已完成","已完成","已完成","已提交","","plan/2026-01-01_14-03-09-codex-shell-claude-code.md:21; executor/agents/factory.py:31; executor/agents/base.py:25; executor/agents/claude_code/claude_code_agent.py:58; executor/agents/codex/codex_agent.py:28; executor/tests/agents/test_codex_agent.py:1","picked_reason:Implement CodexAgent to enable Codex shell execution path in executor. | done_at:2026-01-01 evidence:executor_pytest_passed,codex_agent_unit_tests_added validation_limited:real_codex_and_claudecode_runs_require_api_keys manual_test:cd_executor&&uv_run_pytest;OPENAI_API_KEY=... codex_exec --json -C <repo> - < prompt;ClaudeCode_requires_ANTHROPIC_API_KEY risk:medium"
"CODEX-050","P0","5","both","Align streaming/events with UI message model","Ensure Codex emits the same callback/WebSocket event shapes as existing shells so `useUnifiedMessages` renders correctly (start/chunk/done, progress, error).","In UI, Codex tasks show start→streaming chunks→done; chunks merge correctly; final status becomes completed; errors show as error status; cancel stops streaming and updates state.","AUTOE2E","Follow existing event schema; keep message IDs/timestamps stable; do not bypass `useUnifiedMessages` single source of truth.","Run end-to-end chat flow (send→stream→done), refresh, and group-chat scenarios; verify no regressions in existing shells.","未开始","未开始","未开始","未提交","","plan/2026-01-01_14-03-09-codex-shell-claude-code.md:22; backend/app/api/ws/chat_namespace.py:834; frontend/src/features/tasks/hooks/useUnifiedMessages.ts:17",""
"CODEX-060","P1","6","backend","Backend: add shellType=Codex","Extend backend schema/wizard/init_data so Codex is a first-class shell type that can be selected/recommended and persisted like others.","Backend accepts `shell_type=Codex` where applicable; init_data includes a public Codex Shell; wizard flow supports Codex; existing shell types remain backward compatible.","AUTOSERVER","Keep CRD naming consistent; avoid breaking API contracts; update validation/model aggregation only where necessary; add migration only if needed.","Run backend tests and sanity-check wizard outputs for Chat/ClaudeCode/Agno/Codex; verify existing shells unchanged.","未开始","未开始","未开始","未提交","","plan/2026-01-01_14-03-09-codex-shell-claude-code.md:23; backend/app/schemas/wizard.py:83; backend/app/api/endpoints/wizard.py:568; backend/init_data/02-public-shells.yaml:10",""
"CODEX-070","P1","7","executor_manager","Executor Manager: enable Codex + image validation","Allow Codex in `/images/validate` and add Codex dependency checks to ImageValidatorAgent; ensure dispatch/cancel works for Codex tasks.","validate endpoint accepts shell_type=Codex and returns async validation results; ImageValidator has Codex checks with stable pass/fail payload; Codex tasks are dispatchable and cancellable.","AUTOSERVER","Validation checks should be minimal-but-sufficient and version-robust; keep error payload schema stable; maintain Dify skip behavior.","Validate Codex/ClaudeCode/Agno images; run concurrent validations; verify existing dispatcher paths unaffected.","未开始","未开始","未开始","未提交","","plan/2026-01-01_14-03-09-codex-shell-claude-code.md:24; executor_manager/routers/routers.py:446; executor/agents/image_validator/image_validator_agent.py:37",""
"CODEX-080","P1","8","frontend","Frontend: expose Codex shell + capability gating","Add Codex to UI types/forms/i18n and gate features (skills/attachments/MCP) based on Codex capabilities, avoiding ClaudeCode-only special cases.","Codex appears as selectable shell; forms validate; en/zh i18n updated; UI does not mis-handle Codex as ClaudeCode; skills/attachments/MCP UI follow the parity matrix decisions.","AUTOFRONTEND","Update TS unions and any ClaudeCode-specific checks; keep behavior consistent across settings/task UI; update mocks if used for development.","Run frontend unit/lint; smoke-test settings and task creation; ensure existing ClaudeCode/Agno flows unchanged.","未开始","未开始","未开始","未提交","","plan/2026-01-01_14-03-09-codex-shell-claude-code.md:25; frontend/src/features/settings/components/BotEdit.tsx:44; frontend/src/i18n/locales/en/common.json:843; frontend/src/i18n/locales/zh-CN/common.json:844",""
"CODEX-090","P0","9","both","Add Codex tests + end-to-end regression","Add minimal but critical unit/integration tests across executor/backend/executor_manager/frontend plus one runnable Codex end-to-end regression flow.","Module tests pass; one Codex E2E scenario is runnable and non-skipped; failures are actionable (no silent skip); existing test suites do not regress.","AUTOE2E","Mock external services; keep tests deterministic; follow AAA; do not introduce `test.skip()` for e2e.","Run full recommended test commands for all modules + e2e; verify Codex flow and existing shells pass.","未开始","未开始","未开始","未提交","","plan/2026-01-01_14-03-09-codex-shell-claude-code.md:26; AGENTS.md:55",""
"CODEX-100","P2","10","docs","Docs + rollout/rollback for Codex shell","Document Codex usage/config/build/troubleshooting and define rollout/rollback switches to disable Codex safely.","Docs added in docs/en and docs/zh with install/config/build/known-limits/troubleshooting; rollout flag exists; rollback procedure disables Codex without impacting other shells.","AUTOSERVER","Follow docs principle (details in docs/); keep secrets out; include operational checklist and limitations.","Dry-run docs steps in a clean environment; verify disabling Codex is safe and leaves Chat/ClaudeCode/Agno usable.","未开始","未开始","未开始","未提交","","plan/2026-01-01_14-03-09-codex-shell-claude-code.md:27; docs/en/README.md:1; docs/zh/README.md:1",""
