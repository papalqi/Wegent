"id","priority","phase","area","title","description","acceptance_criteria","test_mcp","review_initial_requirements","review_regression_requirements","dev_state","review_initial_state","review_regression_state","git_state","owner","refs","notes"
"MSP-010","P2","1","both","同步最新 main 并创建功能分支","从最新 origin/main 创建新分支并锁定本次改动范围（兼容存量模型配置）。","本地位于新分支且基于最新 main（可用 `git log -1` 对齐 origin/main）；不引入破坏性迁移；分支命名符合规范。","AUTOSERVER","确认改动范围与兼容策略（存量 base_url/model_id 不强制迁移）；避免引入 secrets。","确认后续 PR 基于该分支；合并前检查无多余文件/无敏感信息。","已完成","已完成","已完成","已提交","","plan/2026-01-02_18-13-24-model-settings-models-probe.md:1","picked_reason:先对齐最新 main 并建立开发分支 done_at:2026-01-02T18:33:03+08:00 evidence:branch=feature/model-settings-models-probe base=upstream/main blocked:git_commit_format_hook_failed_at:2026-01-02T18:33:27+08:00 unblocked:git_commit_format_fixed_at:2026-01-02T18:33:52+08:00"
"MSP-020","P2","2","both","梳理 Model 设置现状与复用点","确认现有模型配置/测试入口与接口边界，避免重复造轮子并明确改造点。","列出将要改动/新增的关键文件与 API（至少包含 ModelEditDialog、models API、后端 adapter/models）；明确 “/models/unified != 上游 /models”。","AUTOFRONTEND","对齐术语：Model 资源（CRD） vs provider 上游模型列表；确认 UI 交互不会导致频繁外呼。","确认最终实现仍复用现有组件/接口（如可复用则不重复实现）。","未开始","未开始","未开始","未提交","","plan/2026-01-02_18-13-24-model-settings-models-probe.md:1;frontend/src/features/settings/components/ModelEditDialog.tsx:1;backend/app/api/endpoints/adapter/models.py:1;frontend/src/apis/models.ts:1",""
"MSP-030","P0","3","backend","新增 provider 模型列表接口（后端代理 /models）","新增 `POST /models/provider-models`，由后端携带 api_key/custom_headers 请求上游 `/models` 并返回可选 model_ids。","接口可返回上游模型列表（含空列表/鉴权失败/不支持端点等错误）；支持 custom_headers；返回不包含敏感信息；有单测覆盖主要分支。","AUTOSERVER","日志/异常中禁止输出明文 api_key；为上游请求设置超时与错误分类；接口返回结构稳定。","在本地/CI 跑 `cd backend && uv run pytest` 通过；确认不影响现有 `/models/*` 路由。","已完成","已完成","已完成","已提交","","plan/2026-01-02_18-13-24-model-settings-models-probe.md:1;backend/app/api/endpoints/adapter/models.py:1","picked_reason:P0 后端先提供 /models 代理能力以解锁前端选择器 start_at:2026-01-02T18:35:32+08:00 done_at:2026-01-02T18:37:52+08:00 evidence:backend_pytest=tests/api/test_provider_models.py"
"MSP-040","P0","4","both","base_url 归一化与最终拼接地址展示","允许用户不填 `/v1`；前端实时展示解析后的最终 base_url；后端对 OpenAI-compatible 兜底补齐/裁剪。","输入 `https://api.openai.com`/`http://localhost:8000` 可展示并使用 `.../v1`；输入 `.../v1/` 归一化为 `.../v1`；不同 provider（anthropic/gemini）不强行补 `/v1`，UI 有明确提示。","AUTOE2E","规则必须文档化且与后端实现一致；避免仅前端拼接导致后端实际请求不一致。","创建/编辑模型保存后不破坏存量 base_url；联调验证真实请求走解析后的地址。","已完成","已完成","已完成","已提交","","plan/2026-01-02_18-13-24-model-settings-models-probe.md:1;frontend/src/features/settings/components/ModelEditDialog.tsx:1;backend/app/api/endpoints/adapter/models.py:1","picked_reason:P0 base_url 解析规则影响保存/测试行为，先实现并与后端一致 start_at:2026-01-02T18:43:34+08:00 done_at:2026-01-02T18:49:20+08:00 evidence:frontend_jest=provider-base-url validation_limited:no_e2e manual_test:cd_frontend&&npm_run_test:e2e risk:medium"
"MSP-050","P0","5","frontend","ModelEditDialog：model_id 改为可检索选择（带 Custom 回退）","在模型编辑弹窗中新增“获取模型列表/搜索选择”流程，默认从后端拉取 provider 模型列表，失败时可手输。","用户可点击拉取并在下拉中搜索/选择 model_id；拉取失败可切换为 Custom 手输；不会在输入每个字符时自动请求；保存时仍兼容现有 model_id 存储。","AUTOFRONTEND","交互设计：加载态/错误态/空列表；避免将 api_key 暴露到 URL/query；i18n 文案补齐。","编辑已有模型（含 group scope）不丢字段；与 ModelList 展示一致；`npm test` 通过。","未开始","未开始","未开始","未提交","","plan/2026-01-02_18-13-24-model-settings-models-probe.md:1;frontend/src/features/settings/components/ModelEditDialog.tsx:317;frontend/src/apis/models.ts:1",""
"MSP-060","P1","6","frontend","ModelEditDialog：结构化探测结果 UI（OK/Fail + 耗时 + 错误）","将“测试连接”从 toast 升级为弹窗内可视化的分项探测结果展示。","点击测试后展示每项 check（list_models/prompt_llm/embed 等）的状态、耗时与错误摘要；执行中禁用按钮；失败不误报成功。","AUTOFRONTEND","UI 状态必须可重复（同输入可重测）；错误信息需可读且不泄露敏感 header。","与后端返回结构对齐；在创建/编辑流程中不影响保存；`npm test` 通过。","未开始","未开始","未开始","未提交","","plan/2026-01-02_18-13-24-model-settings-models-probe.md:1;frontend/src/features/settings/components/ModelEditDialog.tsx:317",""
"MSP-070","P0","7","backend","新增 provider-probe：用完整请求做端口/模型检测","新增 `POST /models/provider-probe`，对目标 provider 进行结构化探测（不仅连通性），并返回每项 check 的 ok/latency/error。","至少支持：list_models（上游 /models）、prompt_llm（可判定 prompt + 响应校验）、embedding（向量维度>0）；不支持能力返回明确 unsupported；有超时与错误分类；有单测。","AUTOSERVER","探测提示可能计费；默认手动触发；日志脱敏；对 provider_type/base_url 做校验。","跑 `cd backend && uv run pytest` 通过；确认不破坏现有 `POST /models/test-connection`（或保持兼容并逐步迁移）。","已完成","已完成","已完成","已提交","","plan/2026-01-02_18-13-24-model-settings-models-probe.md:1;backend/app/api/endpoints/adapter/models.py:313","picked_reason:P0 先实现结构化 probe 为前端 OK/Fail 展示提供数据 start_at:2026-01-02T18:38:36+08:00 done_at:2026-01-02T18:42:09+08:00 evidence:backend_pytest=tests/api/test_provider_probe.py"
"MSP-080","P1","8","both","补齐单测/回归：后端 pytest + 前端 npm test + 联调验证","为新增/改造点补测试并跑全套关键测试，确保创建/编辑/探测/列表展示链路不回归。","`cd backend && uv run pytest` 通过；`cd frontend && npm test` 通过；手动回归：创建模型→解析地址展示→拉取模型列表→选择 model_id→探测显示 OK/Fail→保存→列表展示/再次编辑不丢字段。","AUTOE2E","测试覆盖至少包含：base_url 解析、拉取失败回退、探测结果渲染；后端覆盖错误分类与超时分支。","回归覆盖 group/personal 两种 scope；必要时验证 ModelList 的测试按钮行为一致。","未开始","未开始","未开始","未提交","","plan/2026-01-02_18-13-24-model-settings-models-probe.md:1;frontend/src/features/settings/components/ModelList.tsx:227;frontend/src/apis/models.ts:292;backend/app/api/endpoints/adapter/models.py:313",""
"MSP-090","P2","9","both","更新文档与 UI 提示（/v1 自动拼接 + 探测可能计费）","补齐开发/用户提示：base_url 可不带 /v1；探测会发送真实请求（可能计费），默认手动触发。","相关文档/页面提示已更新且可被发现；UI 中对计费/频控/失败原因有明确说明（至少在探测按钮附近）。","AUTOFRONTEND","文案符合 i18n 规范；不要泄露实现细节/密钥；强调“手动触发”。","最终回归确认提示存在且不影响正常流程。","未开始","未开始","未开始","未提交","","plan/2026-01-02_18-13-24-model-settings-models-probe.md:1;frontend/src/features/settings/components/ModelEditDialog.tsx:1",""
